<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <title>SVGjs Animation Test</title>
    <!-- <script type="text/javascript" src="../Scripts/svgjs/svg.js"></script> -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/2.5.0/svg.js"></script>
    <script>
        function DisplayError(message_) {
            document.getElementById("errorDisplay").textContent = message_;
        }

        function DisplaySetAngle(angle) {
            document.getElementById("angleSet").textContent = "Angle Set to: " + angle;
        }

        function DisplayActualAngle(angle) {
            document.getElementById("angleActual").textContent = "Actual Angle: " + angle;
        }

        function JugglerPosition(x_, y_, angle_) {
            this.x = 0;
            this.y = 0;
            this.angle = 0;
            if (undefined !== x_) {
                this.x = x_
            }
            if (undefined !== y_) {
                this.y = y_
            }
            if (undefined !== angle_) {
                this.angle = angle_
            }
        }



        function JugglerView(svgRoot_, name_, position_) {
            let pathStyle = {
                stroke: "#000000",
                "stroke-width": 1,
                fill: "none"
            };
            this.juggler = svgRoot_.group();
            // build the torso group
            this.torso = this.juggler.group();
            this.torso.path("M 19.798 -30.072 C 13.049 -30.072 6.308 -30.072 2.927 -25.144 C 0.222 -21.198 -0.318 -14.093 -0.425 -6.244 C -0.452 -4.29 -0.452 -2.289 -0.452 -0.28 C -0.452 1.551 -0.452 3.378 -0.431 5.174 C -0.337 13.265 0.183 20.705 3.046 24.856 C 6.538 29.928 13.55 29.928 20.548 29.928").attr(pathStyle);
            this.rightHand = this.torso.circle(12).center(21, 30).attr(pathStyle).fill({
                color: "#e80000"
            });
            this.leftHand = this.torso.circle(12).center(21, -30).attr(pathStyle).fill({
                color: "#00e800"
            });
            // torso built
            this.juggler.circle(24).center(0, 0).attr(pathStyle).fill({
                color: "#ebebeb"
            });
            this.juggler.text(name_).center(0, 0).attr({
                "font-size": "15px"
            });
            this.juggler.move(position_.x, position_.y);
            this.torso.rotate(position_.angle, 0, 0);
        }

        JugglerView.prototype.animateToAngle = function(angle_, time_) {
            var time = 1;
            var angle = this.angle;
            if (undefined !== time_) {
                time = time_;
            }
            if (undefined != angle_) {
                angle = angle_;
            }
            DisplaySetAngle(angle);
            let angleMatrix = new SVG.Matrix().rotate(this.angle);

            this.torso.animate(1000, "-", 0).transform(angleMatrix).after(function(situation) {
                DisplayActualAngle(this.transform("rotation").toString());
            });

        }



        function onLeftTurn() {
            if (jugglerAngle > 0) {
                jugglerAngle -= 45;
                jugglerView.animateToAngle(jugglerAngle);
            }
        }

        function onRightTurn() {
            if (jugglerAngle < 360) {
                jugglerAngle += 45;
                jugglerView.animateToAngle(jugglerAngle);
            }
        }

        window.onload = function() {
            svgRoot = SVG("jugglerImage").size(600, 400).viewbox(0, 0, 95, 95);
            jugglerAngle = 0;

            try {
                //curPosition = new JugglerPosition(40, 45, 0)
                var curPosition = {
                    x: 40,
                    y: 45,
                    angle: 0
                };
                jugglerView = (new JugglerView(svgRoot, "A", curPosition));

            } catch (err) {
                DisplayError("Error creating JugglerView because: " + err.message);
                return;
            }

            //jugglerView.animateToAngle(45, 1);

        }
    </script>
    <style>
        body {
            background-color: #505050;
        }
    </style>
</head>

<body>
    <h2>Animation of a juggler torso</h2>
    <div id="jugglerImage"></div>
    <button id="leftTurn" type="button" onclick="onLeftTurn()">&lt</button>
    <button id="rightTurn" type="button" onclick="onRightTurn()">&gt</button>
    <p id="angleSet" style="white-space:pre"></p>
    <p id="angleActual" style="white-space:pre"></p>
    <p id="errorDisplay" style="white-space:pre"></p>


</body>

</html>